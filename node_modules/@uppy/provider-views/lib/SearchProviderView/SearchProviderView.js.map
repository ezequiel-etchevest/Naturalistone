{"version":3,"names":["h","SearchFilterInput","Browser","CloseWrapper","View","packageJson","_updateFilesAndInputMode","_classPrivateFieldLooseKey","SearchProviderView","constructor","plugin","opts","Object","defineProperty","value","_updateFilesAndInputMode2","defaultOptions","viewType","showTitles","showFilter","showBreadcrumbs","search","bind","clearSearch","resetPluginState","handleScroll","donePicking","render","defaultState","isInputMode","files","folders","breadcrumbs","filterInput","currentSelection","searchTerm","setPluginState","tearDown","query","getPluginState","setLoading","res","provider","_classPrivateFieldLooseBase","err","handleError","event","nextPageQuery","shouldHandleScroll","isHandlingScroll","response","error","uppy","log","addFiles","map","file","getTagFile","state","viewOptions","_this","didFirstRender","i18n","preFirstRender","targetViewOptions","loading","isChecked","toggleCheckbox","filterItems","recordShiftKeyPress","hasInput","browserProps","done","cancel","cancelPicking","showSearchFilter","searchOnInput","searchInputLabel","clearSearchLabel","noResultsLabel","title","isLoading","pluginIcon","icon","uppyFiles","getFiles","validateRestrictions","arguments","onUnmount","className","clearSelection","inputLabel","buttonLabel","inputClassName","buttonCSSClassName","showButton","items","forEach","item","push","searchedFor","VERSION","version"],"sources":["SearchProviderView.jsx"],"sourcesContent":["import { h } from 'preact'\n\nimport SearchFilterInput from '../SearchFilterInput.jsx'\nimport Browser from '../Browser.jsx'\nimport CloseWrapper from '../CloseWrapper.js'\nimport View from '../View.js'\n\nimport packageJson from '../../package.json'\n\n/**\n * SearchProviderView, used for Unsplash and future image search providers.\n * Extends generic View, shared with regular providers like Google Drive and Instagram.\n */\nexport default class SearchProviderView extends View {\n  static VERSION = packageJson.version\n\n  /**\n   * @param {object} plugin instance of the plugin\n   * @param {object} opts\n   */\n  constructor (plugin, opts) {\n    super(plugin, opts)\n\n    // set default options\n    const defaultOptions = {\n      viewType: 'grid',\n      showTitles: false,\n      showFilter: false,\n      showBreadcrumbs: false,\n    }\n\n    // merge default options with the ones set by user\n    this.opts = { ...defaultOptions, ...opts }\n\n    // Logic\n    this.search = this.search.bind(this)\n    this.clearSearch = this.clearSearch.bind(this)\n    this.resetPluginState = this.resetPluginState.bind(this)\n    this.handleScroll = this.handleScroll.bind(this)\n    this.donePicking = this.donePicking.bind(this)\n\n    // Visual\n    this.render = this.render.bind(this)\n\n    this.defaultState = {\n      isInputMode: true,\n      files: [],\n      folders: [],\n      breadcrumbs: [],\n      filterInput: '',\n      currentSelection: [],\n      searchTerm: null,\n    }\n\n    // Set default state for the plugin\n    this.plugin.setPluginState(this.defaultState)\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  tearDown () {\n    // Nothing.\n  }\n\n  resetPluginState () {\n    this.plugin.setPluginState(this.defaultState)\n  }\n\n  #updateFilesAndInputMode (res, files) {\n    this.nextPageQuery = res.nextPageQuery\n    res.items.forEach((item) => { files.push(item) })\n    this.plugin.setPluginState({\n      currentSelection: [],\n      isInputMode: false,\n      files,\n      searchTerm: res.searchedFor,\n    })\n  }\n\n  async search (query) {\n    const { searchTerm } = this.plugin.getPluginState()\n    if (query && query === searchTerm) {\n      // no need to search again as this is the same as the previous search\n      return\n    }\n\n    this.setLoading(true)\n    try {\n      const res = await this.provider.search(query)\n      this.#updateFilesAndInputMode(res, [])\n    } catch (err) {\n      this.handleError(err)\n    } finally {\n      this.setLoading(false)\n    }\n  }\n\n  clearSearch () {\n    this.plugin.setPluginState({\n      currentSelection: [],\n      files: [],\n      searchTerm: null,\n    })\n  }\n\n  async handleScroll (event) {\n    const query = this.nextPageQuery || null\n\n    if (this.shouldHandleScroll(event) && query) {\n      this.isHandlingScroll = true\n\n      try {\n        const { files, searchTerm } = this.plugin.getPluginState()\n        const response = await this.provider.search(searchTerm, query)\n\n        this.#updateFilesAndInputMode(response, files)\n      } catch (error) {\n        this.handleError(error)\n      } finally {\n        this.isHandlingScroll = false\n      }\n    }\n  }\n\n  donePicking () {\n    const { currentSelection } = this.plugin.getPluginState()\n    this.plugin.uppy.log('Adding remote search provider files')\n    this.plugin.uppy.addFiles(currentSelection.map((file) => this.getTagFile(file)))\n    this.resetPluginState()\n  }\n\n  render (state, viewOptions = {}) {\n    const { didFirstRender, isInputMode, searchTerm } = this.plugin.getPluginState()\n    const { i18n } = this.plugin.uppy\n\n    if (!didFirstRender) {\n      this.preFirstRender()\n    }\n\n    const targetViewOptions = { ...this.opts, ...viewOptions }\n    const { files, folders, filterInput, loading, currentSelection } = this.plugin.getPluginState()\n    const { isChecked, toggleCheckbox, filterItems, recordShiftKeyPress } = this\n    const hasInput = filterInput !== ''\n\n    const browserProps = {\n      isChecked,\n      toggleCheckbox,\n      recordShiftKeyPress,\n      currentSelection,\n      files: hasInput ? filterItems(files) : files,\n      folders: hasInput ? filterItems(folders) : folders,\n      handleScroll: this.handleScroll,\n      done: this.donePicking,\n      cancel: this.cancelPicking,\n\n      // For SearchFilterInput component\n      showSearchFilter: targetViewOptions.showFilter,\n      search: this.search,\n      clearSearch: this.clearSearch,\n      searchTerm,\n      searchOnInput: false,\n      searchInputLabel: i18n('search'),\n      clearSearchLabel: i18n('resetSearch'),\n\n      noResultsLabel: i18n('noSearchResults'),\n      title: this.plugin.title,\n      viewType: targetViewOptions.viewType,\n      showTitles: targetViewOptions.showTitles,\n      showFilter: targetViewOptions.showFilter,\n      isLoading: loading,\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      pluginIcon: this.plugin.icon,\n      i18n,\n      uppyFiles: this.plugin.uppy.getFiles(),\n      validateRestrictions: (...args) => this.plugin.uppy.validateRestrictions(...args),\n    }\n\n    if (isInputMode) {\n      return (\n        <CloseWrapper onUnmount={this.resetPluginState}>\n          <div className=\"uppy-SearchProvider\">\n            <SearchFilterInput\n              search={this.search}\n              clearSelection={this.clearSelection}\n              inputLabel={i18n('enterTextToSearch')}\n              buttonLabel={i18n('searchImages')}\n              inputClassName=\"uppy-c-textInput uppy-SearchProvider-input\"\n              buttonCSSClassName=\"uppy-SearchProvider-searchButton\"\n              showButton\n            />\n          </div>\n        </CloseWrapper>\n      )\n    }\n\n    return (\n      <CloseWrapper onUnmount={this.resetPluginState}>\n        {/* eslint-disable-next-line react/jsx-props-no-spreading */}\n        <Browser {...browserProps} />\n      </CloseWrapper>\n    )\n  }\n}\n"],"mappings":"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"}