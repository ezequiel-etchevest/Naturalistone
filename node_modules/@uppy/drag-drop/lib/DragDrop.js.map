{"version":3,"names":["UIPlugin","toArray","isDragDropSupported","getDroppedFiles","h","packageJson","locale","DragDrop","constructor","uppy","opts","handleDrop","event","_this$opts$onDrop","_this$opts","preventDefault","stopPropagation","clearTimeout","removeDragOverClassTimeout","setPluginState","isDraggingOver","logDropError","error","log","files","dataTransfer","length","addFiles","onDrop","call","type","id","title","defaultLocale","defaultOpts","target","inputName","width","height","note","i18nInit","onInputChange","bind","handleDragOver","handleDragLeave","render","descriptors","map","file","source","name","data","meta","relativePath","err","value","_this$opts$onDragOver","_this$opts2","types","hasFiles","some","allowNewUpload","getState","dropEffect","onDragOver","_this$opts$onDragLeav","_this$opts3","setTimeout","onDragLeave","renderHiddenFileInput","restrictions","className","hidden","ref","fileInputRef","multiple","maxNumberOfFiles","accept","allowedFileTypes","onChange","renderArrowSvg","focusable","viewBox","d","fillRule","renderLabel","i18nArray","browse","i18n","renderNote","dragDropClass","getPluginState","dragDropStyle","style","onClick","click","install","mount","uninstall","unmount","VERSION","version"],"sources":["DragDrop.jsx"],"sourcesContent":["import { UIPlugin } from '@uppy/core'\nimport toArray from '@uppy/utils/lib/toArray'\nimport isDragDropSupported from '@uppy/utils/lib/isDragDropSupported'\nimport getDroppedFiles from '@uppy/utils/lib/getDroppedFiles'\nimport { h } from 'preact'\n\nimport packageJson from '../package.json'\nimport locale from './locale.js'\n\n/**\n * Drag & Drop plugin\n *\n */\nexport default class DragDrop extends UIPlugin {\n  static VERSION = packageJson.version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'DragDrop'\n    this.title = 'Drag & Drop'\n\n    this.defaultLocale = locale\n\n    // Default options, must be kept in sync with @uppy/react/src/DragDrop.js.\n    const defaultOpts = {\n      target: null,\n      inputName: 'files[]',\n      width: '100%',\n      height: '100%',\n      note: null,\n    }\n\n    // Merge default options with the ones set by user\n    this.opts = { ...defaultOpts, ...opts }\n\n    this.i18nInit()\n\n    // Check for browser dragDrop support\n    this.isDragDropSupported = isDragDropSupported()\n    this.removeDragOverClassTimeout = null\n\n    // Bind `this` to class methods\n    this.onInputChange = this.onInputChange.bind(this)\n    this.handleDragOver = this.handleDragOver.bind(this)\n    this.handleDragLeave = this.handleDragLeave.bind(this)\n    this.handleDrop = this.handleDrop.bind(this)\n    this.addFiles = this.addFiles.bind(this)\n    this.render = this.render.bind(this)\n  }\n\n  addFiles (files) {\n    const descriptors = files.map((file) => ({\n      source: this.id,\n      name: file.name,\n      type: file.type,\n      data: file,\n      meta: {\n        // path of the file relative to the ancestor directory the user selected.\n        // e.g. 'docs/Old Prague/airbnb.pdf'\n        relativePath: file.relativePath || null,\n      },\n    }))\n\n    try {\n      this.uppy.addFiles(descriptors)\n    } catch (err) {\n      this.uppy.log(err)\n    }\n  }\n\n  onInputChange (event) {\n    const files = toArray(event.target.files)\n    if (files.length > 0) {\n      this.uppy.log('[DragDrop] Files selected through input')\n      this.addFiles(files)\n    }\n\n    // We clear the input after a file is selected, because otherwise\n    // change event is not fired in Chrome and Safari when a file\n    // with the same name is selected.\n    // ___Why not use value=\"\" on <input/> instead?\n    //    Because if we use that method of clearing the input,\n    //    Chrome will not trigger change if we drop the same file twice (Issue #768).\n    // eslint-disable-next-line no-param-reassign\n    event.target.value = null\n  }\n\n  handleDragOver (event) {\n    event.preventDefault()\n    event.stopPropagation()\n\n    // Check if the \"type\" of the datatransfer object includes files. If not, deny drop.\n    const { types } = event.dataTransfer\n    const hasFiles = types.some(type => type === 'Files')\n    const { allowNewUpload } = this.uppy.getState()\n    if (!hasFiles || !allowNewUpload) {\n      // eslint-disable-next-line no-param-reassign\n      event.dataTransfer.dropEffect = 'none'\n      clearTimeout(this.removeDragOverClassTimeout)\n      return\n    }\n\n    // Add a small (+) icon on drop\n    // (and prevent browsers from interpreting this as files being _moved_ into the browser\n    // https://github.com/transloadit/uppy/issues/1978)\n    //\n    // eslint-disable-next-line no-param-reassign\n    event.dataTransfer.dropEffect = 'copy'\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    this.setPluginState({ isDraggingOver: true })\n\n    this.opts.onDragOver?.(event)\n  }\n\n  handleDragLeave (event) {\n    event.preventDefault()\n    event.stopPropagation()\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    // Timeout against flickering, this solution is taken from drag-drop library.\n    // Solution with 'pointer-events: none' didn't work across browsers.\n    this.removeDragOverClassTimeout = setTimeout(() => {\n      this.setPluginState({ isDraggingOver: false })\n    }, 50)\n\n    this.opts.onDragLeave?.(event)\n  }\n\n  handleDrop = async (event) => {\n    event.preventDefault()\n    event.stopPropagation()\n    clearTimeout(this.removeDragOverClassTimeout)\n\n    // Remove dragover class\n    this.setPluginState({ isDraggingOver: false })\n\n    const logDropError = (error) => {\n      this.uppy.log(error, 'error')\n    }\n\n    // Add all dropped files\n    const files = await getDroppedFiles(event.dataTransfer, { logDropError })\n    if (files.length > 0) {\n      this.uppy.log('[DragDrop] Files dropped')\n      this.addFiles(files)\n    }\n\n    this.opts.onDrop?.(event)\n  }\n\n  renderHiddenFileInput () {\n    const { restrictions } = this.uppy.opts\n    return (\n      <input\n        className=\"uppy-DragDrop-input\"\n        type=\"file\"\n        hidden\n        ref={(ref) => { this.fileInputRef = ref }}\n        name={this.opts.inputName}\n        multiple={restrictions.maxNumberOfFiles !== 1}\n        accept={restrictions.allowedFileTypes}\n        onChange={this.onInputChange}\n      />\n    )\n  }\n\n  static renderArrowSvg () {\n    return (\n      <svg aria-hidden=\"true\" focusable=\"false\" className=\"uppy-c-icon uppy-DragDrop-arrow\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\">\n        <path d=\"M11 10V0H5v10H2l6 6 6-6h-3zm0 0\" fillRule=\"evenodd\" />\n      </svg>\n    )\n  }\n\n  renderLabel () {\n    return (\n      <div className=\"uppy-DragDrop-label\">\n        {this.i18nArray('dropHereOr', {\n          browse: <span className=\"uppy-DragDrop-browse\">{this.i18n('browse')}</span>,\n        })}\n      </div>\n    )\n  }\n\n  renderNote () {\n    return (\n      <span className=\"uppy-DragDrop-note\">{this.opts.note}</span>\n    )\n  }\n\n  render () {\n    const dragDropClass = `uppy-u-reset\n      uppy-DragDrop-container\n      ${this.isDragDropSupported ? 'uppy-DragDrop--isDragDropSupported' : ''}\n      ${this.getPluginState().isDraggingOver ? 'uppy-DragDrop--isDraggingOver' : ''}\n    `\n\n    const dragDropStyle = {\n      width: this.opts.width,\n      height: this.opts.height,\n    }\n\n    return (\n      <button\n        type=\"button\"\n        className={dragDropClass}\n        style={dragDropStyle}\n        onClick={() => this.fileInputRef.click()}\n        onDragOver={this.handleDragOver}\n        onDragLeave={this.handleDragLeave}\n        onDrop={this.handleDrop}\n      >\n        {this.renderHiddenFileInput()}\n        <div className=\"uppy-DragDrop-inner\">\n          {DragDrop.renderArrowSvg()}\n          {this.renderLabel()}\n          {this.renderNote()}\n        </div>\n      </button>\n    )\n  }\n\n  install () {\n    const { target } = this.opts\n\n    this.setPluginState({\n      isDraggingOver: false,\n    })\n\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n}\n"],"mappings":"AAAA,SAASA,QAAQ,QAAQ,YAAY;AACrC,OAAOC,OAAO,MAAM,yBAAyB;AAC7C,OAAOC,mBAAmB,MAAM,qCAAqC;AACrE,OAAOC,eAAe,MAAM,iCAAiC;AAC7D,SAASC,CAAC,QAAQ,QAAQ;AAAA,MAEnBC,WAAW;EAAA;AAAA;AAClB,OAAOC,MAAM,MAAM,aAAa;;AAEhC;AACA;AACA;AACA;AACA,eAAe,MAAMC,QAAQ,SAASP,QAAQ,CAAC;EAG7CQ,WAAWA,CAAEC,IAAI,EAAEC,IAAI,EAAE;IACvB,KAAK,CAACD,IAAI,EAAEC,IAAI,CAAC;IAAA,KAiHnBC,UAAU,GAAG,MAAOC,KAAK,IAAK;MAAA,IAAAC,iBAAA,EAAAC,UAAA;MAC5BF,KAAK,CAACG,cAAc,CAAC,CAAC;MACtBH,KAAK,CAACI,eAAe,CAAC,CAAC;MACvBC,YAAY,CAAC,IAAI,CAACC,0BAA0B,CAAC;;MAE7C;MACA,IAAI,CAACC,cAAc,CAAC;QAAEC,cAAc,EAAE;MAAM,CAAC,CAAC;MAE9C,MAAMC,YAAY,GAAIC,KAAK,IAAK;QAC9B,IAAI,CAACb,IAAI,CAACc,GAAG,CAACD,KAAK,EAAE,OAAO,CAAC;MAC/B,CAAC;;MAED;MACA,MAAME,KAAK,GAAG,MAAMrB,eAAe,CAACS,KAAK,CAACa,YAAY,EAAE;QAAEJ;MAAa,CAAC,CAAC;MACzE,IAAIG,KAAK,CAACE,MAAM,GAAG,CAAC,EAAE;QACpB,IAAI,CAACjB,IAAI,CAACc,GAAG,CAAC,0BAA0B,CAAC;QACzC,IAAI,CAACI,QAAQ,CAACH,KAAK,CAAC;MACtB;MAEA,CAAAX,iBAAA,IAAAC,UAAA,OAAI,CAACJ,IAAI,EAACkB,MAAM,qBAAhBf,iBAAA,CAAAgB,IAAA,CAAAf,UAAA,EAAmBF,KAAK,CAAC;IAC3B,CAAC;IApIC,IAAI,CAACkB,IAAI,GAAG,UAAU;IACtB,IAAI,CAACC,EAAE,GAAG,IAAI,CAACrB,IAAI,CAACqB,EAAE,IAAI,UAAU;IACpC,IAAI,CAACC,KAAK,GAAG,aAAa;IAE1B,IAAI,CAACC,aAAa,GAAG3B,MAAM;;IAE3B;IACA,MAAM4B,WAAW,GAAG;MAClBC,MAAM,EAAE,IAAI;MACZC,SAAS,EAAE,SAAS;MACpBC,KAAK,EAAE,MAAM;MACbC,MAAM,EAAE,MAAM;MACdC,IAAI,EAAE;IACR,CAAC;;IAED;IACA,IAAI,CAAC7B,IAAI,GAAG;MAAE,GAAGwB,WAAW;MAAE,GAAGxB;IAAK,CAAC;IAEvC,IAAI,CAAC8B,QAAQ,CAAC,CAAC;;IAEf;IACA,IAAI,CAACtC,mBAAmB,GAAGA,mBAAmB,CAAC,CAAC;IAChD,IAAI,CAACgB,0BAA0B,GAAG,IAAI;;IAEtC;IACA,IAAI,CAACuB,aAAa,GAAG,IAAI,CAACA,aAAa,CAACC,IAAI,CAAC,IAAI,CAAC;IAClD,IAAI,CAACC,cAAc,GAAG,IAAI,CAACA,cAAc,CAACD,IAAI,CAAC,IAAI,CAAC;IACpD,IAAI,CAACE,eAAe,GAAG,IAAI,CAACA,eAAe,CAACF,IAAI,CAAC,IAAI,CAAC;IACtD,IAAI,CAAC/B,UAAU,GAAG,IAAI,CAACA,UAAU,CAAC+B,IAAI,CAAC,IAAI,CAAC;IAC5C,IAAI,CAACf,QAAQ,GAAG,IAAI,CAACA,QAAQ,CAACe,IAAI,CAAC,IAAI,CAAC;IACxC,IAAI,CAACG,MAAM,GAAG,IAAI,CAACA,MAAM,CAACH,IAAI,CAAC,IAAI,CAAC;EACtC;EAEAf,QAAQA,CAAEH,KAAK,EAAE;IACf,MAAMsB,WAAW,GAAGtB,KAAK,CAACuB,GAAG,CAAEC,IAAI,KAAM;MACvCC,MAAM,EAAE,IAAI,CAAClB,EAAE;MACfmB,IAAI,EAAEF,IAAI,CAACE,IAAI;MACfpB,IAAI,EAAEkB,IAAI,CAAClB,IAAI;MACfqB,IAAI,EAAEH,IAAI;MACVI,IAAI,EAAE;QACJ;QACA;QACAC,YAAY,EAAEL,IAAI,CAACK,YAAY,IAAI;MACrC;IACF,CAAC,CAAC,CAAC;IAEH,IAAI;MACF,IAAI,CAAC5C,IAAI,CAACkB,QAAQ,CAACmB,WAAW,CAAC;IACjC,CAAC,CAAC,OAAOQ,GAAG,EAAE;MACZ,IAAI,CAAC7C,IAAI,CAACc,GAAG,CAAC+B,GAAG,CAAC;IACpB;EACF;EAEAb,aAAaA,CAAE7B,KAAK,EAAE;IACpB,MAAMY,KAAK,GAAGvB,OAAO,CAACW,KAAK,CAACuB,MAAM,CAACX,KAAK,CAAC;IACzC,IAAIA,KAAK,CAACE,MAAM,GAAG,CAAC,EAAE;MACpB,IAAI,CAACjB,IAAI,CAACc,GAAG,CAAC,yCAAyC,CAAC;MACxD,IAAI,CAACI,QAAQ,CAACH,KAAK,CAAC;IACtB;;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACAZ,KAAK,CAACuB,MAAM,CAACoB,KAAK,GAAG,IAAI;EAC3B;EAEAZ,cAAcA,CAAE/B,KAAK,EAAE;IAAA,IAAA4C,qBAAA,EAAAC,WAAA;IACrB7C,KAAK,CAACG,cAAc,CAAC,CAAC;IACtBH,KAAK,CAACI,eAAe,CAAC,CAAC;;IAEvB;IACA,MAAM;MAAE0C;IAAM,CAAC,GAAG9C,KAAK,CAACa,YAAY;IACpC,MAAMkC,QAAQ,GAAGD,KAAK,CAACE,IAAI,CAAC9B,IAAI,IAAIA,IAAI,KAAK,OAAO,CAAC;IACrD,MAAM;MAAE+B;IAAe,CAAC,GAAG,IAAI,CAACpD,IAAI,CAACqD,QAAQ,CAAC,CAAC;IAC/C,IAAI,CAACH,QAAQ,IAAI,CAACE,cAAc,EAAE;MAChC;MACAjD,KAAK,CAACa,YAAY,CAACsC,UAAU,GAAG,MAAM;MACtC9C,YAAY,CAAC,IAAI,CAACC,0BAA0B,CAAC;MAC7C;IACF;;IAEA;IACA;IACA;IACA;IACA;IACAN,KAAK,CAACa,YAAY,CAACsC,UAAU,GAAG,MAAM;IAEtC9C,YAAY,CAAC,IAAI,CAACC,0BAA0B,CAAC;IAC7C,IAAI,CAACC,cAAc,CAAC;MAAEC,cAAc,EAAE;IAAK,CAAC,CAAC;IAE7C,CAAAoC,qBAAA,IAAAC,WAAA,OAAI,CAAC/C,IAAI,EAACsD,UAAU,qBAApBR,qBAAA,CAAA3B,IAAA,CAAA4B,WAAA,EAAuB7C,KAAK,CAAC;EAC/B;EAEAgC,eAAeA,CAAEhC,KAAK,EAAE;IAAA,IAAAqD,qBAAA,EAAAC,WAAA;IACtBtD,KAAK,CAACG,cAAc,CAAC,CAAC;IACtBH,KAAK,CAACI,eAAe,CAAC,CAAC;IAEvBC,YAAY,CAAC,IAAI,CAACC,0BAA0B,CAAC;IAC7C;IACA;IACA,IAAI,CAACA,0BAA0B,GAAGiD,UAAU,CAAC,MAAM;MACjD,IAAI,CAAChD,cAAc,CAAC;QAAEC,cAAc,EAAE;MAAM,CAAC,CAAC;IAChD,CAAC,EAAE,EAAE,CAAC;IAEN,CAAA6C,qBAAA,IAAAC,WAAA,OAAI,CAACxD,IAAI,EAAC0D,WAAW,qBAArBH,qBAAA,CAAApC,IAAA,CAAAqC,WAAA,EAAwBtD,KAAK,CAAC;EAChC;EAwBAyD,qBAAqBA,CAAA,EAAI;IACvB,MAAM;MAAEC;IAAa,CAAC,GAAG,IAAI,CAAC7D,IAAI,CAACC,IAAI;IACvC,OACEN,CAAA;MACEmE,SAAS,EAAC,qBAAqB;MAC/BzC,IAAI,EAAC,MAAM;MACX0C,MAAM;MACNC,GAAG,EAAGA,GAAG,IAAK;QAAE,IAAI,CAACC,YAAY,GAAGD,GAAG;MAAC,CAAE;MAC1CvB,IAAI,EAAE,IAAI,CAACxC,IAAI,CAAC0B,SAAU;MAC1BuC,QAAQ,EAAEL,YAAY,CAACM,gBAAgB,KAAK,CAAE;MAC9CC,MAAM,EAAEP,YAAY,CAACQ,gBAAiB;MACtCC,QAAQ,EAAE,IAAI,CAACtC;IAAc,CAC9B,CAAC;EAEN;EAEA,OAAOuC,cAAcA,CAAA,EAAI;IACvB,OACE5E,CAAA;MAAK,eAAY,MAAM;MAAC6E,SAAS,EAAC,OAAO;MAACV,SAAS,EAAC,iCAAiC;MAAClC,KAAK,EAAC,IAAI;MAACC,MAAM,EAAC,IAAI;MAAC4C,OAAO,EAAC;IAAW,GAC9H9E,CAAA;MAAM+E,CAAC,EAAC,iCAAiC;MAACC,QAAQ,EAAC;IAAS,CAAE,CAC3D,CAAC;EAEV;EAEAC,WAAWA,CAAA,EAAI;IACb,OACEjF,CAAA;MAAKmE,SAAS,EAAC;IAAqB,GACjC,IAAI,CAACe,SAAS,CAAC,YAAY,EAAE;MAC5BC,MAAM,EAAEnF,CAAA;QAAMmE,SAAS,EAAC;MAAsB,GAAE,IAAI,CAACiB,IAAI,CAAC,QAAQ,CAAQ;IAC5E,CAAC,CACE,CAAC;EAEV;EAEAC,UAAUA,CAAA,EAAI;IACZ,OACErF,CAAA;MAAMmE,SAAS,EAAC;IAAoB,GAAE,IAAI,CAAC7D,IAAI,CAAC6B,IAAW,CAAC;EAEhE;EAEAM,MAAMA,CAAA,EAAI;IACR,MAAM6C,aAAa,GAAI;AAC3B;AACA,QAAQ,IAAI,CAACxF,mBAAmB,GAAG,oCAAoC,GAAG,EAAG;AAC7E,QAAQ,IAAI,CAACyF,cAAc,CAAC,CAAC,CAACvE,cAAc,GAAG,+BAA+B,GAAG,EAAG;AACpF,KAAK;IAED,MAAMwE,aAAa,GAAG;MACpBvD,KAAK,EAAE,IAAI,CAAC3B,IAAI,CAAC2B,KAAK;MACtBC,MAAM,EAAE,IAAI,CAAC5B,IAAI,CAAC4B;IACpB,CAAC;IAED,OACElC,CAAA;MACE0B,IAAI,EAAC,QAAQ;MACbyC,SAAS,EAAEmB,aAAc;MACzBG,KAAK,EAAED,aAAc;MACrBE,OAAO,EAAEA,CAAA,KAAM,IAAI,CAACpB,YAAY,CAACqB,KAAK,CAAC,CAAE;MACzC/B,UAAU,EAAE,IAAI,CAACrB,cAAe;MAChCyB,WAAW,EAAE,IAAI,CAACxB,eAAgB;MAClChB,MAAM,EAAE,IAAI,CAACjB;IAAW,GAEvB,IAAI,CAAC0D,qBAAqB,CAAC,CAAC,EAC7BjE,CAAA;MAAKmE,SAAS,EAAC;IAAqB,GACjChE,QAAQ,CAACyE,cAAc,CAAC,CAAC,EACzB,IAAI,CAACK,WAAW,CAAC,CAAC,EAClB,IAAI,CAACI,UAAU,CAAC,CACd,CACC,CAAC;EAEb;EAEAO,OAAOA,CAAA,EAAI;IACT,MAAM;MAAE7D;IAAO,CAAC,GAAG,IAAI,CAACzB,IAAI;IAE5B,IAAI,CAACS,cAAc,CAAC;MAClBC,cAAc,EAAE;IAClB,CAAC,CAAC;IAEF,IAAIe,MAAM,EAAE;MACV,IAAI,CAAC8D,KAAK,CAAC9D,MAAM,EAAE,IAAI,CAAC;IAC1B;EACF;EAEA+D,SAASA,CAAA,EAAI;IACX,IAAI,CAACC,OAAO,CAAC,CAAC;EAChB;AACF;AAlOqB5F,QAAQ,CACpB6F,OAAO,GAAG/F,WAAW,CAACgG,OAAO"}