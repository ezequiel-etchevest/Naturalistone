version: "3.9"
services: 
    expressapp:
        container_name: expressapp
        build: ./api
        expose: 
            - 5000
        volumes:
            - ./api:/usr/src/app
    reactapp:
        container_name: reactapp
        build: ./client
        expose: 
            - 3000
        volumes:
            - ./client:/usr/src/app
    nginx:
        build: ./nginx
        ports:
            - 80:80
        links:
            - expressapp
            - reactapp
            - nginx-proxy
            - letsencrypt
        environments:
            - VIRTUAL_HOST=internal-naturalistone.com ,www.internal-naturalistone.com 
            - LETSENCRYPT_HOST=internal-naturalistone.com ,www.internal-naturalistone.com   
        restart: always
    nginx-proxy:
        image: jwilder/nginx-proxy
        restart: always
        ports:
            - "80:80"
            - "443:443"
        volumes:
            - /var/run/docker.sock:/tmp/docker.sock:ro
            - certs:/etc/nginx/certs:ro
            - vhostd:/etc/nginx/vhost.docker
            - html:/usr/share/nginx/html
        labels:
            - com.github.jrcs.letsencrypt_nginx_proxy_companion.nginx_proxy

        letsencrypt:
            image: jrcd/letsencrypt-nginx-proxy-letsencrypt_nginx_proxy_companion
            restart: always
            enviroment:
            - NGINX_PROXY_CONTAINER=nginx-proxy
            volumes:
                - certs:/etc/nginx/certs:rw
                - /var/run/docker.sock:/var/run/docker.sock:ro
                - vhostd:/etc/nginx/vhost.d
                - html:/usr/share/nginx/html
    volumes:
     certs:
     html:
     vhostd: